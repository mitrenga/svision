/**/
const { AbstractFonts } = await import('../../../abstractFonts.js?ver='+window.srcVersion);
/*/
import AbstractFonts from '../../../abstractFonts.js';
/**/
// begin code

export class ZXFonts8x8 extends AbstractFonts {

  constructor(app, proportional) {
    super(app);
    this.id = 'ZXFonts8x8';

    this.proportional = proportional;
    if (proportional) {
      this.charsSpacing = 2;
    }

    this.fontsChars = ' !"#$%&\'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_£abcdefghijklmnopqrstuvwxyz{|}~©‗';
    this.fontsData = '00000000000000000010101010001000002424000000000000247E24247E240000083E283E0A3E080062640810264600001028102A443A00000810000000000000040808080804000020101010102000000014083E081400000008083E0808000000000000080810000000003E00000000000000001818000000020408102000003C464A52623C000018280808083E00003C42023C407E00003C420C02423C0000081828487E0800007E407C02423C00003C407C42423C00007E020408101000003C423C42423C00003C42423E023C000000001000001000000010000010102000000408100804000000003E003E00000000100804081000003C420408000800003C4A565E403C00003C42427E424200007C427C42427C00003C424040423C000078444242447800007E407C40407E00007E407C40404000003C42404E423C000042427E42424200003E080808083E000002020242423C0000444870484442000040404040407E000042665A42424200004262524A464200003C424242423C00007C42427C404000003C4242524A3C00007C42427C444200003C403C02423C0000FE1010101010000042424242423C00004242424224180000424242425A240000422418182442000082442810101000007E040810207E00000E080808080E0000004020100804000070101010107000001038541010100000000000000000FF001C227820207E00000038043C443C000020203C22223C0000001C2020201C000004043C44443C000000384478403C00000C10181010100000003C44443C043800404078444444000010003010103800000400040404241800202830302824000010101010100C00000068545454540000007844444444000000384444443800000078444478404000003C44443C040600001C202020200000003840380478000010381010100C00000044444444380000004444282810000000445454542800000044281028440000004444443C043800007C0810207C00000E083008080E0000080808080808000070100C1010700000142800000000003C4299A1A199423C000000000000F8F8';
    //this.fontsData = '00000000000000000038383838003800006C6C244800000000287C287C280000003C303C0C3C000000666C183066460000386C387ECC7E000030301020000000001C383838381C0000381C1C1C1C3800001010FE386C440000003838FE38380000000000181808100000003E3E00000000000000001818000000060C18306000007CEEEEEEEE7C00001C3C7C1C1C3E00003C6E0E3C707E00003C6E1C0E6E3C00001C3C7CDCFE1C0000FCE0FC0ECE7C00007CE0FCEEEE7C0000FE0E1C38707000007CEE7CEEEE7C00007CEEEE7E0E7C000018180000181800003030003030102000001C3870381C0000003E3E003E3E000000381C0E1C3800003C6E1C18001800007CF6EEECF07C00007CEEEEFEEEEE0000FCEEFCEEEEFC00007CF6F0F0F67C0000FCEEEEEEEEFC00007EF0FCF0F07E00007EF0FCF0F0F000007CE6E0EEE67C0000EEEEFEEEEEEE00007C383838387C00000E0E0E4E6E3C0000ECF8F0F8ECE60000E0E0E0E0E0FE0000C6EEFEFEEEEE00007CEEEEEEEEEE00007CEEEEEEEE7C0000FCEEEEFCE0E000007CEEEEFEEE7C0000FCEEEEFCECE600007CE07C0EEE7C0000FE38383838380000EEEEEEEEEE7C0000EEEEEEEE6C380000EEEEEEEEFE6C0000EEEE7C7CEEEE0000EEEEEE6C38380000FE1E3C78F0FE00001E1C1C1C1C1E0000006030180C060000783838383878000010387C3838380000000000000000FF001C36307C303E0000003C0E7EEE7E0000E0E0FCEEEEFC0000003C7070703C000006067EEEEE7E0000007CEEFCE07C00007CE0F8E0E0E00000007EEEEE7E063C00E0E0FCEEEEEE000038007838387C00000C000C0CEC7C3800006C7870786C000070707070703C000000ECFEFED6D6000000F8FCCCCCCC0000007CEEEEEE7C000000FCEEEEFCE0E000007EEEEE7E060600007CECE0E0E000000078E0781C78000070F87070763C000000EEEEEEEE7C000000446C7C3810000000C6D6D6FE28000000CC783078CC000000EEEEEE7E063C0000FC3C78F0FC00001E18183018181E0038383838383800007818180C1818780024486C6C000000003C624E4E623C00000000000000F8F8';
    //this.fontsData = '00000000000000000018181818180018002424000000000000247E34347E240000107E507E167E100066640810266600003828102A642A100030304000000000001830202020301800180C0404040C1800663C18183C66000018187E7E1818000000000038383860000000007E7E00000000000070707000001818007E001818007E464A52627E000018181808080800007E46067E407E00007E06067E027E00007C4464647E0400007E42407E067E00007E62607E427E00007E020206060600007E62627E427E00007E46467E02020000181800001818000018180000181860000008103010080000007E7E007E7E000000080406040800007E461E18180018007F414F4B6F607F003C243E62626200007C447E62627E00007E424060627E00007E424262627E00007E407E60607E00007E407E60606000007E424066627E000042427E6262620000101010181818000004040406467E000044447E626262000040404060607C00007E4A4A6A6A6A00007E424262626200007E464242427E00007E427E60606000007E4242424E7E000078487E62626200007E407E06067E00007E1010181818000042424262627E000062626226243C00004A4A4A6A6A7E0000427E187E6262000042427E18181800007E0C0810307E00000E080808080E000000402010080400007010101010700000103854101010000000000000FFFF00003E322070207E0000003E023E323E000040407C44647C0000003E2220323E000002023E22263E0000003E323E203E00001C10381018180000003E22323E023E0020203E2232320000080008080C0C00000800080C0C041C004858507C64640000180808080C0C0000007E4A6A6A620000003E222232320000003E2622223E0000003E22323E202000003E22323E020200003C242030300000003E203E063E000010381010181C000000222222323E000000323216141C000000425256567E00000024241834340000003232223E023E00003E0C08183E00000E083008080E0000080808080808000070100C1010700000142800000000003C4299A1A199423C000000000000F8F8';
    //this.fontsData = '00000000000000000010101010001000002424000000000014147E28FC505000107C507C14547C1042A44810244A8400001028102A443A00000810000000000000182020202018000030080808083000000014083E081400000008083E0808000000000000080810000000003E00000000000000001818000204081020408000007C4C5454647C000018280808083E00007C440438407C00007C441804447C00001828487E081C00007C407C04447C00007C407C44447C00007C440810101000007C443844447C00007C44447C047C000000001000001000000010000010102000000408100804000000003E003E00000000100804081000007C441C100010003C42BD85BDA5BE78003C42427E42E70000FC427C4242FC00007E424040427E0000FE42424242FE0000FE42784042FE0000FE42784040E000007E42404E427E0000E7427E4242E700007C101010107C00007E08080848780000E648705844E60000E040404242FE0000C3665A4242E70000C762524A46E700007E424242427E0000FE42427E40E000007E424242527E0800FE42427E44E700007E407E02427E0000FE92101010380000CE444444447E0000E742424224180000D7929292926C0000EE44382844EE0000EE442810103800007E440810227E001C10101010101C0000004020100804003808080808083800001038541010100000000000000000FF003C247020207C0000007C047C447E00C0407C4444447C0000007C4440407C000C047C4444447E0000007C447C407C003C2470202020700000007C44447C047CC0407C444444E6001000701010107C000800380808084878C0404C506058CC007010101010107C000000FC545454D6000000FC444444E60000007C4444447C0000007E22223E207000007C44447C040600007C242020700000007C407C04FC0000207820202038000000CC4444447E000000CE44442838000000D65454547E000000C6281028C6000000CC44447C047C00007E4418227E00701010101010100C1010101010101C0010101010101070001C101010101010603C42BDA1A1BD423C000000000000F8F8';
  } // constructor

  getCharData(char, bitMask, scale) {
    var width = 8;
    var charObject = {data: []};
    var binData = [];
    var letter = this.fontsChars.indexOf(char);
    if (letter < 0) {
      letter = this.fontsChars.indexOf('?');
    }
    for (var y = 0; y < 8; y++) {
      binData.push(this.app.hexToBin(this.fontsData.substring(letter*16+y*2, letter*16+y*2+2)));
    }

    // convert for proportional font
    if (this.proportional == true) {

      // left cut
      var doIt = true;
      while (doIt == true) {
        for (var y = 0; y < 8; y++) {
          if (binData[y][0] == bitMask) {
            doIt = false;
            break;
          }
        }
        if (doIt == true) {
          for (var y = 0; y < 8; y++) {
            binData[y] = binData[y].substring(1, width);
          }
          width--;
        }
        if (char == ' ') {
          doIt = false;
        }
      }

      // right cut
      doIt = true;
      while (doIt == true) {
        for (var y = 0; y < 8; y++) {
          if (binData[y][binData[y].length-1] == bitMask) {
            doIt = false;
            break;
          }
        }
        if (doIt == true) {
          for (var y = 0; y < 8; y++) {
            binData[y] = binData[y].substring(0, width-1);
          }
          width--;
        }
        if (char == ' ' && width < 6) {
          doIt = false;
        }
      }
      for (var y = 0; y < 8; y++) {
        binData[y] = binData[y];
      }
    }

    // convert binary to array
    binData.forEach ((mask, y) => {
      for (var x = 0; x < mask.length; x++) {
        if (mask[x] == bitMask) {
          charObject.data.push([x*scale, y*scale, scale, scale]);
        }
      }
    });
    charObject.width = width*scale;

    return charObject;
  } // getCharData

  validChar(char) {
    if (this.fontsChars.indexOf(char) >= 0) {
      return true;
    }
    return false;
  } // validChar

} // class ZXFonts8x8

export default ZXFonts8x8;
