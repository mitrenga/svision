/**/
const { TextView } = await import('../textView.js?ver='+window.srcVersion);
/*/
import TextView from '../textView.js';
/**/
// begin code

export class ZXTextView extends TextView {

  constructor(parentView, x, y, width, height, text, penColor, bkColor, fontType, proportional) {
    super(parentView, x, y, width, height);
    this.id = 'ZXTextView';
    this.penColor = penColor;
    this.bkColor = bkColor;
    
    this.text = text;
    this.fontType = fontType;
    this.proportional = proportional;

    this.zxFonts = {
      chars: ' !"#$%&\'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_£abcdefghijklmnopqrstuvwxyz{|}~©',
      0: '00000000000000000010101010001000002424000000000000247E24247E240000083E283E0A3E080062640810264600001028102A443A00000810000000000000040808080804000020101010102000000014083E081400000008083E0808000000000000080810000000003E00000000000000001818000000020408102000003C464A52623C000018280808083E00003C42023C407E00003C420C02423C0000081828487E0800007E407C02423C00003C407C42423C00007E020408101000003C423C42423C00003C42423E023C000000001000001000000010000010102000000408100804000000003E003E00000000100804081000003C420408000800003C4A565E403C00003C42427E424200007C427C42427C00003C424040423C000078444242447800007E407C40407E00007E407C40404000003C42404E423C000042427E42424200003E080808083E000002020242423C0000444870484442000040404040407E000042665A42424200004262524A464200003C424242423C00007C42427C404000003C4242524A3C00007C42427C444200003C403C02423C0000FE1010101010000042424242423C00004242424224180000424242425A240000422418182442000082442810101000007E040810207E00000E080808080E0000004020100804000070101010107000001038541010100000000000000000FF001C227820207E00000038043C443C000020203C22223C0000001C2020201C000004043C44443C000000384478403C00000C10181010100000003C44443C043800404078444444000010003010103800000400040404241800202830302824000010101010100C00000068545454540000007844444444000000384444443800000078444478404000003C44443C040600001C202020200000003840380478000010381010100C00000044444444380000004444282810000000445454542800000044281028440000004444443C043800007C0810207C00000E083008080E0000080808080808000070100C1010700000142800000000003C4299A1A199423C',
      1: '00000000000000000010101010001000002424000000000014147E28FC505000107C507C14547C1042A44810244A8400001028102A443A00000810000000000000182020202018000030080808083000000014083E081400000008083E0808000000000000080810000000003E00000000000000001818000204081020408000007C4C5454647C000018280808083E00007C440438407C00007C441804447C00001828487E081C00007C407C04447C00007C407C44447C00007C440810101000007C443844447C00007C44447C047C000000001000001000000010000010102000000408100804000000003E003E00000000100804081000007C441C100010003C42BD85BDA5BE78003C42427E42E70000FC427C4242FC00007E424040427E0000FE42424242FE0000FE42784042FE0000FE42784040E000007E42404E427E0000E7427E4242E700007C101010107C00007E08080848780000E648705844E60000E040404242FE0000C3665A4242E70000C762524A46E700007E424242427E0000FE42427E40E000007E424242527E0800FE42427E44E700007E407E02427E0000FE92101010380000CE444444447E0000E742424224180000D7929292926C0000EE44382844EE0000EE442810103800007E440810227E001C10101010101C0000004020100804003808080808083800001038541010100000000000000000FF003C247020207C0000007C047C447E00C0407C4444447C0000007C4440407C000C047C4444447E0000007C447C407C003C2470202020700000007C44447C047CC0407C444444E6001000701010107C000800380808084878C0404C506058CC007010101010107C000000FC545454D6000000FC444444E60000007C4444447C0000007E22223E207000007C44447C040600007C242020700000007C407C04FC0000207820202038000000CC4444447E000000CE44442838000000D65454547E000000C6281028C6000000CC44447C047C00007E4418227E00701010101010100C1010101010101C0010101010101070001C101010101010603C42BDA1A1BD423C'
    };
  } // constructor

  getTextChar(position) {
    return this.text[position];
  } // getTextChar

  getTextLength() {
    return this.text.length;
  } // getTextLength

  getCharData(char) {
    var width = 8;
    var charObject = {data: []};
    var binData = [];
    for (var y = 0; y < 8; y++) {
      var letter = this.zxFonts['chars'].indexOf(char);
      binData.push(this.app.hexToBin(this.zxFonts[this.fontType].substring(letter*16+y*2, letter*16+y*2+2)));
    }

    // convert for proportional font
    if (this.proportional == true) {

      // left cut
      var doIt = true;
      while (doIt == true) {
        for (var y = 0; y < 8; y++) {
          if (binData[y][0] == '1') {
            doIt = false;
            break;
          }
        }
        if (doIt == true) {
          for (var y = 0; y < 8; y++) {
            binData[y] = binData[y].substring(1, width);
          }
          width--;
        }
        if (char == ' ') {
          doIt = false;
        }
      }

      // right cut
      doIt = true;
      while (doIt == true) {
        for (var y = 0; y < 8; y++) {
          if (binData[y][binData[y].length-1] == '1') {
            doIt = false;
            break;
          }
        }
        if (doIt == true) {
          for (var y = 0; y < 8; y++) {
            binData[y] = binData[y].substring(0, width-1);
          }
          width--;
        }
        if (char == ' ' && width < 6) {
          doIt = false;
        }
      }
      width += 2;
    }

    // convert binary to array
    binData.forEach ((mask, y) => {
      for (var x = 0; x < mask.length; x++) {
        if (mask[x] == '1') {
          charObject['data'].push([x, y, 1, 1]);
        }
      }
    });
    charObject['width'] = width;

    return charObject;
  } // getCharData

} // class ZXTextView

export default ZXTextView;
